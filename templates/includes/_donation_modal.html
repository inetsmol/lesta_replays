{# templates/includes/_donation_modal.html #}
{% load static %}

{% if show_donation_prompts %}
<div x-data="donationModal()" x-init="init()" @keydown.escape.window="closeModal()">
  <!-- Modal -->
  <div x-show="isOpen"
       x-transition:enter="transition ease-out duration-300"
       x-transition:enter-start="opacity-0 scale-95"
       x-transition:enter-end="opacity-100 scale-100"
       x-transition:leave="transition ease-in duration-200"
       x-transition:leave-start="opacity-100 scale-100"
       x-transition:leave-end="opacity-0 scale-95"
       class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm overflow-y-auto"
       style="display: none;"
       @click.self="closeModal()">

    <div class="relative w-full max-w-md my-8 bg-gradient-to-br from-gray-900 to-gray-950 rounded-2xl border border-amber-500/30 shadow-2xl shadow-amber-500/20 overflow-hidden">

      <!-- –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–π —Ñ–æ–Ω -->
      <div class="absolute inset-0 bg-[radial-gradient(circle_at_top_right,_var(--tw-gradient-stops))] from-amber-500/10 via-transparent to-transparent"></div>

      <!-- Header -->
      <div class="relative p-4 border-b border-amber-500/20">
        <div class="absolute inset-0 bg-gradient-to-r from-amber-500/5 to-orange-500/5"></div>
        <div class="relative flex items-center justify-between">
          <div class="flex items-center gap-2">
            <div class="relative">
              <svg width="24" height="24" viewBox="0 0 24 24" class="text-red-500 animate-pulse" fill="currentColor" aria-hidden="true">
                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 6 4 4 6.5 4c1.74 0 3.41.81 4.5 2.09C12.09 4.81 13.76 4 15.5 4 18 4 20 6 20 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
              </svg>
              <div class="absolute inset-0 bg-red-500 blur-lg opacity-40 animate-pulse"></div>
            </div>
            <div>
              <h2 class="text-lg font-bold text-transparent bg-clip-text bg-gradient-to-r from-amber-400 to-orange-500">
                –ü–æ–¥–¥–µ—Ä–∂–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç!
              </h2>
              <p class="text-xs text-gray-400">–ü–æ–º–æ–≥–∏—Ç–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–µ—Ä–≤–∏—Å –∂–∏–≤—ã–º</p>
            </div>
          </div>
          <button @click="closeModal()"
                  class="p-1.5 text-gray-400 hover:text-white hover:bg-white/5 rounded-lg transition-all">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
      </div>

      <!-- Content -->
      <div class="relative p-4 space-y-3">
        <!-- –ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç -->
        <div class="space-y-2">
          <div class="p-3 rounded-lg bg-gradient-to-r from-amber-500/10 to-orange-500/10 border border-amber-500/20">
            <p class="text-sm text-[#e6e6e6] leading-snug text-center font-medium" id="donation-modal-phrase">
              <!-- JavaScript –ø–æ–¥—Å—Ç–∞–≤–∏—Ç —Ç–µ–∫—Å—Ç -->
            </p>
          </div>

          <div class="flex items-start gap-2 p-2.5 rounded-lg bg-red-500/10 border border-red-500/30">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="text-red-400 flex-shrink-0 mt-0.5">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
            </svg>
            <div class="text-xs text-[#e6e6e6] leading-relaxed">
              <p><strong class="text-red-400">–≠—Ç–æ –Ω–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π –ø—Ä–æ–µ–∫—Ç!</strong> –ë–µ–∑ –≤–∞—à–µ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å–µ—Ä–≤–∏—Å –Ω–µ —Å–º–æ–∂–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å. –î–∞–∂–µ <strong class="text-amber-400">100 ‚ÇΩ</strong> –ø–æ–º–æ–≥–∞—é—Ç –æ–ø–ª–∞—á–∏–≤–∞—Ç—å —Ö–æ—Å—Ç–∏–Ω–≥ –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ.</p>
            </div>
          </div>
        </div>

        <!-- YooMoney iframe -->
        <div class="flex justify-center overflow-hidden">
          <iframe
            src="https://yoomoney.ru/quickpay/fundraise/button?billNumber=1D58232QB73.251002&"
            width="220"
            height="50"
            frameborder="0"
            allowtransparency="true"
            scrolling="no"
            style="max-width: 100%;"
            class="rounded-lg shadow-lg">
          </iframe>
        </div>

        <!-- –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å -->
        <div class="relative my-3">
          <div class="absolute inset-0 flex items-center">
            <div class="w-full border-t border-[#292929]"></div>
          </div>
          <div class="relative flex justify-center">
            <span class="px-2 text-xs text-[#b6b6b6] bg-gray-950">–∏–ª–∏</span>
          </div>
        </div>

        <!-- –¢-–ë–∞–Ω–∫ —Å–µ–∫—Ü–∏—è (–∫–æ–º–ø–∞–∫—Ç–Ω–∞—è) -->
        <div>
          <div class="flex items-center gap-1.5 mb-2 justify-center">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="text-yellow-400">
              <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"/>
            </svg>
            <h4 class="text-sm font-semibold text-[#e6e6e6]">
              –î–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –¢-–ë–∞–Ω–∫
            </h4>
          </div>

          <!-- QR-–∫–æ–¥ (200px) -->
          <div class="bg-white rounded-lg p-3 mb-3 shadow-xl border-2 border-yellow-400/20 overflow-hidden mx-auto" style="width: 200px; max-width: 200px;">
            <img
              src="{% static 'donation_qr.png' %}"
              alt="QR-–∫–æ–¥ –¥–ª—è –¥–æ–Ω–∞—Ç–∞"
              style="width: 100%; height: auto; display: block;"
              class="rounded">
            <p class="text-xs text-center text-slate-600 mt-2 font-medium">
              üì± –û—Ç–∫—Ä–æ–π—Ç–µ –∫–∞–º–µ—Ä—É ‚Äî –æ–ø–ª–∞—Ç–∞ –≤ –æ–¥–∏–Ω –∫–ª–∏–∫
            </p>
          </div>

          <!-- CTA –∫–Ω–æ–ø–∫–∞ (220px –∫–∞–∫ YooMoney) -->
          <a
            href="https://www.tinkoff.ru/rm/r_QOueoIJBoY.BitHUDZPXL/7F9Zp34216"
            target="_blank"
            rel="noopener"
            class="group relative mx-auto flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg font-semibold text-white overflow-hidden transition-all duration-300 hover:scale-105 hover:shadow-2xl active:scale-95"
            style="width: 220px; max-width: 220px;">

            <!-- –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω -->
            <div class="absolute inset-0 bg-gradient-to-r from-amber-500 via-orange-500 to-yellow-500"></div>

            <!-- –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–ª–∏–∫ -->
            <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent translate-x-[-200%] group-hover:translate-x-[200%] transition-transform duration-700"></div>

            <!-- –ü—É–ª—å—Å–∏—Ä—É—é—â–µ–µ —Å–≤–µ—á–µ–Ω–∏–µ -->
            <div class="absolute inset-0 bg-yellow-400 blur-xl opacity-50 group-hover:opacity-70 transition-opacity animate-pulse"></div>

            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –∫–Ω–æ–ø–∫–∏ -->
            <span class="relative z-10 flex items-center gap-2">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" class="group-hover:rotate-90 transition-transform duration-300">
                <path d="M12 3C7.03 3 3 7.03 3 12s4.03 9 9 9 9-4.03 9-9-4.03-9-9-9zm1 5v3h3v2h-3v3h-2v-3H8v-2h3V8h2z"/>
              </svg>
              <span class="text-sm">–°–¥–µ–ª–∞—Ç—å –¥–æ–Ω–∞—Ç</span>
            </span>
          </a>
        </div>

        <!-- –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å (–∫–æ–º–ø–∞–∫—Ç–Ω–∞—è) -->
        <div class="pt-3 border-t border-[#292929]">
          <div class="flex items-start gap-2">
            <div class="flex-shrink-0 mt-0.5">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="text-green-400">
                <path d="M12 2L9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2z"/>
              </svg>
            </div>
            <p class="text-xs text-[#b6b6b6] leading-relaxed">
              <span class="text-green-400 font-semibold">–°–ø–∞—Å–∏–±–æ!</span>
              –ö–∞–∂–¥–∞—è –∫–æ–ø–µ–π–∫–∞ –∏–¥—ë—Ç –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞. üöÄ
            </p>
          </div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è -->
        <div class="mt-4">
          <button @click="closeModal()"
                  type="button"
                  class="w-full px-4 py-2 bg-gradient-to-r from-gray-700/50 to-gray-800/50 text-gray-400 text-xs font-medium rounded-lg hover:from-gray-600/50 hover:to-gray-700/50 hover:text-white transition-all border border-gray-700">
            –ó–∞–∫—Ä—ã—Ç—å
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
function donationModal() {
  return {
    isOpen: false,

    // –°–ø–∏—Å–æ–∫ –º–æ—Ç–∏–≤–∏—Ä—É—é—â–∏—Ö —Ñ—Ä–∞–∑ —Å –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ –Ω–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä
    phrases: [
      "‚ùó <strong>–ù–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π –ø—Ä–æ–µ–∫—Ç!</strong> –ë–µ–∑ –≤–∞—à–µ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å–µ—Ä–≤–∏—Å –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ.",
      "‚ö†Ô∏è <strong>–°–µ—Ä–≤–µ—Ä –Ω–µ –æ–ø–ª–∞—Ç–∏—Ç —Å–µ–±—è —Å–∞–º.</strong> –ö–∞–∂–¥—ã–µ 100 ‚ÇΩ –ø—Ä–æ–¥–ª–µ–≤–∞—é—Ç –∂–∏–∑–Ω—å –ø—Ä–æ–µ–∫—Ç–∞!",
      "üíî <strong>–ë–µ–∑ –¥–æ–Ω–∞—Ç–∞ –ø—Ä–æ–µ–∫—Ç —É–º—Ä—ë—Ç.</strong> –ü–æ–º–æ–≥–∏—Ç–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–µ—Ä–≤–∏—Å –¥–ª—è –≤—Å–µ—Ö!",
      "üÜò <strong>–≠—Ç–æ –Ω–µ –±–∏–∑–Ω–µ—Å, –∞ —ç–Ω—Ç—É–∑–∏–∞–∑–º!</strong> –ü–æ–¥–¥–µ—Ä–∂–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç, –ø–æ–∫–∞ –æ–Ω –µ—â—ë –∂–∏–≤.",
      "‚õΩ <strong>–ë–∞–∫ –ø—É—Å—Ç!</strong> –ü–æ–¥–∫–∏–Ω—å—Ç–µ –Ω–µ–º–Ω–æ–≥–æ —Ç–æ–ø–ª–∏–≤–∞, —á—Ç–æ–±—ã –ø–æ—Ä—Ç–∞–ª –ø—Ä–æ–¥–æ–ª–∂–∞–ª —Ä–∞–±–æ—Ç–∞—Ç—å.",
      "üîß <strong>–†–µ–º–æ–Ω—Ç —Ç–∞–Ω–∫–∞ —Å—Ç–æ–∏—Ç –¥–µ–Ω–µ–≥.</strong> –í–∞—à–∏ 100 ‚ÇΩ –¥–µ—Ä–∂–∞—Ç –ø–æ—Ä—Ç–∞–ª –Ω–∞ —Ö–æ–¥—É.",
      "üí∏ <strong>–•–æ—Å—Ç–∏–Ω–≥ –Ω–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π.</strong> –ë–µ–∑ –≤–∞—à–µ–π –ø–æ–º–æ—â–∏ –ø—Ä–æ–µ–∫—Ç –∑–∞–∫—Ä–æ–µ—Ç—Å—è!",
      "ü§ù <strong>–ü—Ä–æ–µ–∫—Ç –¥–µ—Ä–∂–∏—Ç—Å—è –Ω–∞ —á–µ—Å—Ç–Ω–æ–º —Å–ª–æ–≤–µ</strong> –∏ –≤–∞—à–µ–π –ø–æ–¥–¥–µ—Ä–∂–∫–µ. –ü–æ–º–æ–≥–∏—Ç–µ!",
      "üìâ <strong>–°—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –∏—Å—Ö–æ–¥–µ!</strong> –ö–∞–∂–¥—ã–µ 100 ‚ÇΩ ‚Äî —ç—Ç–æ –µ—â—ë –æ–¥–∏–Ω –º–µ—Å—è—Ü —Ä–∞–±–æ—Ç—ã.",
      "‚è∞ <strong>–í—Ä–µ–º—è —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–æ—Ç–∏–≤ –Ω–∞—Å.</strong> –ü–æ–¥–¥–µ—Ä–∂–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç, –ø–æ–∫–∞ –Ω–µ –ø–æ–∑–¥–Ω–æ!",
      "üè¥‚Äç‚ò†Ô∏è <strong>–≠—Ç–æ –Ω–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π –ø—Ä–æ–µ–∫—Ç!</strong> –°–µ—Ä–≤–µ—Ä –Ω–µ –æ–∫—É–ø–∞–µ—Ç—Å—è ‚Äî –Ω—É–∂–Ω–∞ –≤–∞—à–∞ –ø–æ–º–æ—â—å.",
      "üéÆ <strong>–ë–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–ª—è –≤–∞—Å = —É–±—ã—Ç–æ—á–Ω–æ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞.</strong> –ü–æ–º–æ–≥–∏—Ç–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–µ—Ä–≤–∏—Å!",
      "üí™ <strong>–≠–Ω—Ç—É–∑–∏–∞–∑–º –Ω–µ –æ–ø–ª–∞—Ç–∏—Ç —Å–µ—Ä–≤–µ—Ä.</strong> –í–∞—à–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–∞!",
      "üåü <strong>–û–¥–Ω–∞ —á–∞—à–∫–∞ –∫–æ—Ñ–µ –¥–ª—è –≤–∞—Å</strong> = –º–µ—Å—è—Ü —Ä–∞–±–æ—Ç—ã –¥–ª—è –≤—Å–µ—Ö. –ù–µ –¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç—É —É–º–µ—Ä–µ—Ç—å!",
      "üî• <strong>–ü–æ—Ä—Ç–∞–ª –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π, –Ω–æ –Ω–µ –º–∞–≥–∏—á–µ—Å–∫–∏–π.</strong> –ü–æ–¥–¥–µ—Ä–∂–∏—Ç–µ –∏–ª–∏ –ø–æ—Ç–µ—Ä—è–µ—Ç–µ –Ω–∞–≤—Å–µ–≥–¥–∞!"
    ],

    init() {
      console.log('[DonationModal] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–æ–Ω–∞—Ç–∞');

      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é —Ñ—Ä–∞–∑—É
      const phraseEl = document.getElementById('donation-modal-phrase');
      if (phraseEl) {
        phraseEl.innerHTML = this.phrases[Math.floor(Math.random() * this.phrases.length)];
      }

      // –°–ª—É—à–∞–µ–º —Å–æ–±—ã—Ç–∏–µ –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
      window.addEventListener('open-donation-modal', () => {
        console.log('[DonationModal] –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ open-donation-modal');
        this.openModal();
      });

      // –î–ª—è –æ—Ç–ª–∞–¥–∫–∏: –¥–æ–±–∞–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
      window.openDonationModal = () => {
        console.log('[DonationModal] –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ window.openDonationModal()');
        this.openModal();
      };
    },

    openModal() {
      console.log('[DonationModal] –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ');
      this.isOpen = true;
      document.body.style.overflow = 'hidden';

      // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—Ä–∞–∑—É –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏
      const phraseEl = document.getElementById('donation-modal-phrase');
      if (phraseEl) {
        phraseEl.innerHTML = this.phrases[Math.floor(Math.random() * this.phrases.length)];
      }
    },

    closeModal() {
      console.log('[DonationModal] –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ');
      this.isOpen = false;
      document.body.style.overflow = '';
    }
  };
}
</script>
{% endif %}
