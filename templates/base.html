{# templates/base.html #}
{% load static %}
{% load tz %}
<!DOCTYPE html>
<html lang="ru">
<head>

    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>{% block title %}{{ page_title|default:"Реплеи Мира танков" }}{% endblock %}</title>
    <meta name="description" content="{% block meta_description %}{{ meta_description|default:"Смотри и анализируй реплеи МИРА ТАНКОВ." }}{% endblock %}">

    <link rel="canonical" href="{% block canonical_url %}{{ canonical_url|default:request.build_absolute_uri }}{% endblock %}">

    <meta property="og:title" content="{% block og_title %}{{ page_title|default:"Реплеи Мира танков" }}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}{{ meta_description|default:"Смотри и анализируй реплеи МИРА ТАНКОВ." }}{% endblock %}">
    <meta property="og:url" content="{% block og_url %}{{ canonical_url|default:request.build_absolute_uri }}{% endblock %}">
    <meta property="og:type" content="{% block og_type %}website{% endblock %}">
    <meta property="og:site_name" content="lesta-replays.ru">
    <meta property="og:locale" content="ru_RU">

    <meta name="twitter:card" content="summary_large_image">

    <link rel="icon" type="image/x-icon" href="{% static 'favicon.ico' %}">
    <link rel="shortcut icon" type="image/x-icon" href="{% static 'favicon.ico' %}">
    <link rel="apple-touch-icon" href="{% static 'favicon.ico' %}">

    <!-- DNS Prefetch для ускорения загрузки с CDN -->
    <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="//unpkg.com">
    <link rel="dns-prefetch" href="//code.jquery.com">
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">

    <!-- Preconnect для критических CDN -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preconnect" href="https://unpkg.com" crossorigin>

    {% block preload_images %}
    {# Блок для preload критических изображений на конкретных страницах #}
    {% endblock %}

    <!-- Tailwind CSS (локальная сборка) -->
    <link rel="stylesheet" href="{% static 'css/output.css' %}">
    <!-- Временно оставляем старые CSS для постепенной миграции -->
    <link rel="stylesheet" href="{% static 'css/site.css' %}">
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@2.0.4"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.3/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">


    {% block extra_head %}{% endblock %}
</head>
<body class="{% block body_class %}{% endblock %}">

{% include "includes/_navbar.html" %}

<div id="content" class="{% block content_mod %}{% endblock %}">
    <div class="flex flex-col md:flex-row gap-5">

        {% include "includes/_sidebar.html" with widgets=left_widgets %}


        <div class="container-center flex-1">
            {% include "includes/_messages.html" %}
            {% block content %}{% endblock %}
        </div>


        {% include "includes/_sidebar.html" with widgets=right_widgets %}

    </div>
</div>

{% include "includes/_footer.html" %}
{% include "includes/_upload_modal.html" %}
{% include "includes/_alert_modal.html" %}

<!-- jQuery (для обратной совместимости) -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<!-- jQuery UI -->
<script src="https://code.jquery.com/ui/1.13.3/jquery-ui.min.js"></script>

<!-- Старый upload-modal.js отключен, используется Alpine.js компонент -->
{# <script src="{% static 'js/upload-modal.js' %}"></script> #}

{% block extra_js %}{% endblock %}

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function (m, e, t, r, i, k, a) {
        m[i] = m[i] || function () {
            (m[i].a = m[i].a || []).push(arguments)
        };
        m[i].l = 1 * new Date();
        for (var j = 0; j < document.scripts.length; j++) {
            if (document.scripts[j].src === r) {
                return;
            }
        }
        k = e.createElement(t), a = e.getElementsByTagName(t)[0], k.async = 1, k.src = r, a.parentNode.insertBefore(k, a)
    })(window, document, 'script', 'https://mc.yandex.ru/metrika/tag.js?id=104234140', 'ym');

    ym(104234140, 'init', {ssr: true, clickmap: true, accurateTrackBounce: true, trackLinks: true});
</script>
<noscript>
    <div><img src="https://mc.yandex.ru/watch/104234140" style="position:absolute; left:-9999px;" alt=""/></div>
</noscript>
<!-- /Yandex.Metrika counter -->

</body>
</html>
