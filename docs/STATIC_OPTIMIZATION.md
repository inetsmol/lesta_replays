# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤

–ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, CSS, JS) –≤ –ø—Ä–æ–µ–∫—Ç–µ Lesta Replays.

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

- **–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä —Å—Ç–∞—Ç–∏–∫–∏**: ~55 –ú–ë
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π**: 2064 —Ñ–∞–π–ª–∞
- **–ò–∫–æ–Ω–∫–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π**: 21 –ú–ë (–æ—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å)
- **–§–æ–Ω–æ–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è**: 400-500 –ö–ë –∫–∞–∂–¥–∞—è

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. WhiteNoise - –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ

**–§–∞–π–ª**: `lesta_replays/settings.py:244-267`

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏**:
```python
WHITENOISE_MAX_AGE = 31536000  # –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ 1 –≥–æ–¥
WHITENOISE_IMMUTABLE_FILE_TEST = None  # –í—Å–µ —Ñ–∞–π–ª—ã immutable
WHITENOISE_USE_FINDERS = DEBUG  # –¢–æ–ª—å–∫–æ collectstatic –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
WHITENOISE_AUTOREFRESH = DEBUG  # Auto-refresh —Ç–æ–ª—å–∫–æ –≤ dev
WHITENOISE_SKIP_COMPRESS_EXTENSIONS = []  # –°–∂–∏–º–∞—Ç—å –≤—Å—ë
```

**–≠—Ñ—Ñ–µ–∫—Ç**:
- –ë—Ä–∞—É–∑–µ—Ä –∫–µ—à–∏—Ä—É–µ—Ç —Å—Ç–∞—Ç–∏–∫—É –Ω–∞ 1 –≥–æ–¥
- –ó–∞–≥–æ–ª–æ–≤–æ–∫ `Cache-Control: public, max-age=31536000, immutable`
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ—Å–µ—â–µ–Ω–∏—è: —Å—Ç–∞—Ç–∏–∫–∞ –≥—Ä—É–∑–∏—Ç—Å—è –∏–∑ –∫–µ—à–∞ –±—Ä–∞—É–∑–µ—Ä–∞
- Gzip/Brotli —Å–∂–∞—Ç–∏–µ –¥–ª—è –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤

### 2. –°–∫—Ä–∏–ø—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

#### 2.1 –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è PNG

**–°–∫—Ä–∏–ø—Ç**: `scripts/optimize_images_png.py`

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —á—Ç–æ –±—É–¥–µ—Ç —Å–¥–µ–ª–∞–Ω–æ
python scripts/optimize_images_png.py

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é
python scripts/optimize_images_png.py --apply

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ backup
python scripts/optimize_images_png.py --restore
```

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è**:
- Pillow —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `optimize=True`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π backup –ø–µ—Ä–µ–¥ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π
- –ü—Ä–æ–ø—É—Å–∫ —Ñ–∞–π–ª–æ–≤ < 10 –ö–ë

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç**: –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –Ω–∞ 20-40%

#### 2.2 –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è JPG

**–°–∫—Ä–∏–ø—Ç**: `scripts/optimize_images_jpg.py`

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —á—Ç–æ –±—É–¥–µ—Ç —Å–¥–µ–ª–∞–Ω–æ
python scripts/optimize_images_jpg.py

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å –∫–∞—á–µ—Å—Ç–≤–æ–º 85 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
python scripts/optimize_images_jpg.py --apply

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º –∫–∞—á–µ—Å—Ç–≤–æ–º
python scripts/optimize_images_jpg.py --apply --quality 90

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ backup
python scripts/optimize_images_jpg.py --restore
```

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è**:
- Pillow —Å `quality=85, optimize=True, progressive=True`
- –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ JPG
- –°—É–±–¥–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü–∏—è —Ü–≤–µ—Ç–∞ 4:2:0
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è CMYK ‚Üí RGB

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç**: –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –Ω–∞ 30-50%

#### 2.3 –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ WebP

**–°–∫—Ä–∏–ø—Ç**: `scripts/convert_to_webp.py`

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —á—Ç–æ –±—É–¥–µ—Ç —Å–¥–µ–ª–∞–Ω–æ
python scripts/convert_to_webp.py

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é
python scripts/convert_to_webp.py --apply

# –° –∫–∞—Å—Ç–æ–º–Ω—ã–º –∫–∞—á–µ—Å—Ç–≤–æ–º
python scripts/convert_to_webp.py --apply --quality 85

# –£–¥–∞–ª–∏—Ç—å –≤—Å–µ WebP —Ñ–∞–π–ª—ã
python scripts/convert_to_webp.py --clean
```

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è**:
- Pillow WebP encoder —Å `quality=80, method=6`
- –°–æ–∑–¥–∞–Ω–∏–µ WebP —Ä—è–¥–æ–º —Å –æ—Ä–∏–≥–∏–Ω–∞–ª–æ–º
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –µ—Å–ª–∏ WebP –±–æ–ª—å—à–µ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (RGBA)

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç**: –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –Ω–∞ 25-35% –æ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª–∞

### 3. Template Tags –¥–ª—è WebP

**–§–∞–π–ª**: `replays/templatetags/webp_tags.py`

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —à–∞–±–ª–æ–Ω–∞—Ö**:

```django
{% load webp_tags %}

{# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä WebP —Å fallback #}
{% webp_image 'images/hero.png' 'Hero image' class='img-fluid' loading='lazy' %}

{# –†–µ–∑—É–ª—å—Ç–∞—Ç: #}
<picture>
    <source srcset="/static/images/hero.webp" type="image/webp">
    <img src="/static/images/hero.png" alt="Hero image" class="img-fluid" loading="lazy">
</picture>

{# –¢–æ–ª—å–∫–æ URL WebP #}
{% webp_url 'images/photo.png' %}

{# Background image —Å WebP #}
<div {% webp_background 'images/bg.jpg' %}>...</div>

{# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è WebP #}
{% if 'images/photo.png'|has_webp %}
    <p>WebP –¥–æ—Å—Ç—É–ø–µ–Ω</p>
{% endif %}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ —Å—Ç–∞—Ä—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã
- –ù–µ –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö HTML –∞—Ç—Ä–∏–±—É—Ç–æ–≤

### 4. Lazy Loading

**–§–∞–π–ª—ã**:
- `templates/base.html:38-40` - –±–ª–æ–∫ –¥–ª—è preload
- `replays/templates/replays/list.html:34,64` - lazy loading –Ω–æ–≤–æ—Å—Ç–µ–π

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
```html
<!-- –ü–µ—Ä–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (above the fold) - eager loading -->
<img src="..." alt="..." loading="eager">

<!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è - lazy loading -->
<img src="..." alt="..." loading="lazy">
```

**–≠—Ñ—Ñ–µ–∫—Ç**:
- –ë—Ä–∞—É–∑–µ—Ä –≥—Ä—É–∑–∏—Ç —Ç–æ–ª—å–∫–æ –≤–∏–¥–∏–º—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–¥–≥—Ä—É–∂–∞—é—Ç—Å—è –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

### 5. Lazy Loading –¥–ª—è –∏–≥—Ä–æ–≤—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–§–∞–π–ª—ã**:
- `replays/templates/replays/list.html:243,248,256,324` - –∫–∞—Ä—Ç—ã, —Ç–∞–Ω–∫–∏, –∑–Ω–∞—á–∫–∏ –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞
- `replays/templates/replays/detail.html:343-345,436-438` - –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö –∏–≥—Ä–æ–∫–æ–≤

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
```html
<!-- –ö–∞—Ä—Ç—ã –∏ —Ç–∞–Ω–∫–∏ –≤ —Å–ø–∏—Å–∫–µ -->
<img class="map" src="..." alt="..." loading="lazy"/>
<img class="tank" src="..." alt="..." loading="lazy"/>

<!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö –∏–≥—Ä–æ–∫–æ–≤ -->
<img class="tank new" src="..." alt="..." loading="lazy">
<img class="type" src="..." alt="..." loading="lazy">
<img class="level" src="..." alt="..." loading="lazy">
```

**–≠—Ñ—Ñ–µ–∫—Ç**:
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ä—Ç –∏ —Ç–∞–Ω–∫–æ–≤ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
- –ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è —Å–ø–∏—Å–∫–∞ —Ä–µ–ø–ª–µ–µ–≤ (–¥–æ 50 –∑–∞–ø–∏—Å–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É)
- –≠–∫–æ–Ω–æ–º–∏—è ~5 –ú–ë —Ç—Ä–∞—Ñ–∏–∫–∞ –Ω–∞ –Ω–∞—á–∞–ª—å–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É (85-90%)

### 5.1. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∫–æ–ø–∏–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞**: –î–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ —Å–≤–µ—á–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–æ—Å—å **4 –∫–æ–ø–∏–∏ –æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è**

**–§–∞–π–ª**: `replays/templates/replays/list.html:266-283`

**–ë—ã–ª–æ** (4 –∫–æ–ø–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –∏–∫–æ–Ω–∫–∏):
```html
<span class="relative">
    <img src="vehicleType.png" class="absolute..." />  <!-- –ö–æ–ø–∏—è 1 -->
    <img src="vehicleType.png" class="absolute..." />  <!-- –ö–æ–ø–∏—è 2 -->
    <img src="vehicleType.png" class="absolute..." />  <!-- –ö–æ–ø–∏—è 3 -->
    <img src="vehicleType.png" class="relative..." />  <!-- –ö–æ–ø–∏—è 4 -->
</span>
```

**–°—Ç–∞–ª–æ** (1 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å CSS filter):
```html
<img
    class="h-[30px] w-[30px]"
    style="filter: brightness(1.25) contrast(1.25)
           drop-shadow(0 0 45px rgba(0,0,0,1))
           drop-shadow(0 0 28px rgba(0,0,0,0.98))
           drop-shadow(0 6px 22px rgba(0,0,0,0.95));"
    src="vehicleType.png"
    alt="Vehicle type"
    loading="lazy"
/>
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- **–ë—ã–ª–æ**: 8 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É (4 –¥–ª—è —Ç–∏–ø–∞ + 4 –¥–ª—è —É—Ä–æ–≤–Ω—è)
- **–°—Ç–∞–ª–æ**: 2 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É (1 –¥–ª—è —Ç–∏–ø–∞ + 1 –¥–ª—è —É—Ä–æ–≤–Ω—è)
- **–≠–∫–æ–Ω–æ–º–∏—è –Ω–∞ 50 —Ä–µ–ø–ª–µ–µ–≤**: 300 HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ ~1.5 –ú–ë —Ç—Ä–∞—Ñ–∏–∫–∞ (-75%)

**–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏**: –°–º. [IMAGE_OPTIMIZATION_SUMMARY.md](IMAGE_OPTIMIZATION_SUMMARY.md)

### 6. DNS Prefetch –∏ Preconnect

**–§–∞–π–ª**: `templates/base.html:28-36`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
```html
<!-- DNS Prefetch –¥–ª—è CDN -->
<link rel="dns-prefetch" href="//cdn.jsdelivr.net">
<link rel="dns-prefetch" href="//unpkg.com">
<link rel="dns-prefetch" href="//code.jquery.com">
<link rel="dns-prefetch" href="//cdnjs.cloudflare.com">

<!-- Preconnect –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö CDN -->
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
<link rel="preconnect" href="https://unpkg.com" crossorigin>
```

**–≠—Ñ—Ñ–µ–∫—Ç**:
- DNS —Ä–µ–∑–æ–ª–≤–∏–Ω–≥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞—Ä–∞–Ω–µ–µ
- TCP handshake –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö CDN
- –≠–∫–æ–Ω–æ–º–∏—è 100-300ms –Ω–∞ –∫–∞–∂–¥–æ–º CDN

## üöÄ –ü–æ—à–∞–≥–æ–≤–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ

### –®–∞–≥ 1: –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è

```bash
# –°–æ–∑–¥–∞—Ç—å backup –≤—Å–µ–π —Å—Ç–∞—Ç–∏–∫–∏
cp -r static static_backup_$(date +%Y%m%d)
```

### –®–∞–≥ 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

```bash
# 1. PNG —Ñ–∞–π–ª—ã (dry run)
python scripts/optimize_images_png.py

# 2. PNG —Ñ–∞–π–ª—ã (–ø—Ä–∏–º–µ–Ω–∏—Ç—å)
python scripts/optimize_images_png.py --apply

# 3. JPG —Ñ–∞–π–ª—ã (dry run)
python scripts/optimize_images_jpg.py

# 4. JPG —Ñ–∞–π–ª—ã (–ø—Ä–∏–º–µ–Ω–∏—Ç—å)
python scripts/optimize_images_jpg.py --apply
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ ~20-30 –ú–ë

### –®–∞–≥ 3: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ WebP

```bash
# –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ WebP
python scripts/convert_to_webp.py --apply
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ ~10-15 –ú–ë –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π WebP

### –®–∞–≥ 4: –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ —Å—Ç–∞—Ç–∏–∫–∏

```bash
# –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã
rm -rf staticfiles

# –°–æ–±—Ä–∞—Ç—å –∑–∞–Ω–æ–≤–æ —Å –Ω–æ–≤—ã–º–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏
python manage.py collectstatic --noinput
```

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä
du -sh staticfiles

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤
find staticfiles -type f | wc -l
```

## üìà –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –†–∞–∑–º–µ—Ä —Å—Ç–∞—Ç–∏–∫–∏: ~55 –ú–ë
- –ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞: ~2-3 —Å–µ–∫—É–Ω–¥—ã (3G)
- –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞: ~1-2 —Å–µ–∫—É–Ω–¥—ã

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –†–∞–∑–º–µ—Ä —Å—Ç–∞—Ç–∏–∫–∏: ~25-35 –ú–ë (‚Üì 40-50%)
- –ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞: ~1-1.5 —Å–µ–∫—É–Ω–¥—ã (3G)
- –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞: < 0.5 —Å–µ–∫—É–Ω–¥—ã (–∏–∑ –∫–µ—à–∞)
- WebP –±—Ä–∞—É–∑–µ—Ä—ã: –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ ‚Üì 25-35%

## üîç –ê–Ω–∞–ª–∏–∑ –∏–≥—Ä–æ–≤—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Ç–∞–Ω–∫–æ–≤ –∏ –∫–∞—Ä—Ç

**–°–∫—Ä–∏–ø—Ç**: `scripts/analyze_game_images.py`

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:

```bash
# –û–±—â–∏–π –∞–Ω–∞–ª–∏–∑ –≤—Å–µ—Ö –∏–≥—Ä–æ–≤—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
python scripts/analyze_game_images.py

# –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã
python scripts/analyze_game_images.py --missing

# –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –±–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã (> 100KB)
python scripts/analyze_game_images.py --large
```

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è**:

- –ù–∞–ª–∏—á–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –≤—Å–µ—Ö —Ç–∞–Ω–∫–æ–≤ –∏–∑ –ë–î
- –ù–∞–ª–∏—á–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –≤—Å–µ—Ö –∫–∞—Ä—Ç –∏–∑ –ë–î
- –†–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤ –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π —Å –∏–∫–æ–Ω–∫–∞–º–∏
- –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã
- –ë–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã —Ç—Ä–µ–±—É—é—â–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞**:

```
üîç –ê–ù–ê–õ–ò–ó –ò–ì–†–û–í–´–• –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô
================================================================================
–ê–ù–ê–õ–ò–ó –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô –¢–ê–ù–ö–û–í
================================================================================

–í—Å–µ–≥–æ —Ç–∞–Ω–∫–æ–≤ –≤ –ë–î: 450

üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
–ù–∞–π–¥–µ–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: 445/450
–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç: 5
–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä: 25.3 MB
–°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä: 58.2 KB

‚ö†Ô∏è  –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–∞–Ω–∫–æ–≤ (5):
  - T-34-85 (ussr_t34_85)
  - Tiger II (germany_tiger_ii)
  ...

üì¶ –ë–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã (> 100KB, 12):
  - IS-7: 156.8 KB
  - Maus: 142.3 KB
  ...
```

## üîÑ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –Ω–æ–≤—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

1. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º**:
   ```bash
   # –î–ª—è –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
   python -c "from PIL import Image; img = Image.open('new.png'); img.save('new.png', optimize=True)"
   ```

2. **–°–æ–∑–¥–∞—Ç—å WebP –≤–µ—Ä—Å–∏—é**:
   ```bash
   python -c "from PIL import Image; Image.open('new.png').save('new.webp', 'WEBP', quality=80)"
   ```

3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —à–∞–±–ª–æ–Ω–∞—Ö —á–µ—Ä–µ–∑ webp_tags**:
   ```django
   {% load webp_tags %}
   {% webp_image 'path/to/new.png' 'Alt text' loading='lazy' %}
   ```

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ä–∞–∑–º–µ—Ä—ã –∏ –∫–∞—á–µ—Å—Ç–≤–æ

| –¢–∏–ø –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è | –§–æ—Ä–º–∞—Ç | –ö–∞—á–µ—Å—Ç–≤–æ | –ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä |
|----------------|--------|----------|--------------|
| –ò–∫–æ–Ω–∫–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π | PNG ‚Üí WebP | 80 | 50 –ö–ë |
| –§–æ–Ω–æ–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è | JPG ‚Üí WebP | 85 | 200 –ö–ë |
| –ö–∞—Ä—Ç—ã | JPG ‚Üí WebP | 85 | 150 –ö–ë |
| UI —ç–ª–µ–º–µ–Ω—Ç—ã | PNG ‚Üí WebP | 90 | 20 –ö–ë |
| –ù–æ–≤–æ—Å—Ç–∏ | JPG ‚Üí WebP | 85 | 300 –ö–ë |

## üõ† Production –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### Nginx (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–µ—Ä–µ–¥ Django)

```nginx
location /static/ {
    alias /path/to/staticfiles/;

    # –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
    expires 1y;
    add_header Cache-Control "public, immutable";

    # Gzip —Å–∂–∞—Ç–∏–µ
    gzip on;
    gzip_vary on;
    gzip_comp_level 6;
    gzip_types text/plain text/css text/xml text/javascript
               application/json application/javascript application/xml+rss
               application/rss+xml image/svg+xml;

    # Brotli (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
    brotli on;
    brotli_comp_level 6;
    brotli_types text/plain text/css text/xml text/javascript
                 application/json application/javascript application/xml+rss
                 application/rss+xml image/svg+xml;
}
```

### CDN (Cloudflare - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ —Ç—Ä–∞—Ñ–∏–∫ –±–æ–ª—å—à–æ–π, —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CDN:

1. **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Cloudflare**:
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ WebP
   - Brotli —Å–∂–∞—Ç–∏–µ
   - –ì–ª–æ–±–∞–ª—å–Ω–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
   - DDoS –∑–∞—â–∏—Ç–∞

2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞**:
   ```python
   # settings.py (production)
   if not DEBUG:
       STATIC_URL = 'https://cdn.lesta-replays.ru/static/'
   ```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

- **Google PageSpeed Insights**: https://pagespeed.web.dev/
- **WebPageTest**: https://www.webpagetest.org/
- **Chrome DevTools Network tab**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –∏ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ production

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Cache-Control –∑–∞–≥–æ–ª–æ–≤–∫–∏
curl -I https://lesta-replays.ru/static/css/output.css

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∂–∞—Ç–∏–µ
curl -H "Accept-Encoding: gzip" -I https://lesta-replays.ru/static/css/output.css

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å WebP –ø–æ–¥–¥–µ—Ä–∂–∫—É
curl -H "Accept: image/webp" https://lesta-replays.ru/static/images/hero.png
```

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: WebP –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `{% webp_image %}` tag - –æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç fallback –Ω–∞ PNG/JPG.

### –ü—Ä–æ–±–ª–µ–º–∞: –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –∫–µ—à–∏—Ä—É—é—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞**:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏
curl -I https://lesta-replays.ru/static/images/photo.png

# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å:
Cache-Control: public, max-age=31536000, immutable
```

**–†–µ—à–µ–Ω–∏–µ**: –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ:
- `DEBUG = False` –≤ production
- `WHITENOISE_MAX_AGE = 31536000` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- –ó–∞–ø—É—â–µ–Ω `collectstatic`

### –ü—Ä–æ–±–ª–µ–º–∞: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–∞–∑–º—ã—Ç—ã

**–†–µ—à–µ–Ω–∏–µ**: –£–≤–µ–ª–∏—á—å—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ –≤ —Å–∫—Ä–∏–ø—Ç–∞—Ö:
```bash
python scripts/optimize_images_jpg.py --apply --quality 90
python scripts/convert_to_webp.py --apply --quality 85
```

## üìù Changelog

### 2025-01-11 - –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç–∏–∫–∏
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ WhiteNoise
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ PNG/JPG
- ‚úÖ –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤ WebP
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã template tags –¥–ª—è WebP —Å fallback
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω lazy loading –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã DNS prefetch –∏ preconnect –¥–ª—è CDN

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

1. **Sprite –¥–ª—è –∏–∫–æ–Ω–æ–∫** - –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –º–µ–ª–∫–∏–µ –∏–∫–æ–Ω–∫–∏ –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª
2. **CDN –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - Cloudflare –∏–ª–∏ –¥—Ä—É–≥–æ–π CDN
3. **Image service** - imgix, Cloudinary –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
4. **HTTP/2 Server Push** - –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
5. **Service Worker** - –¥–ª—è offline –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

---

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞**: 2025-01-11
**–ê–≤—Ç–æ—Ä**: Claude Code
**–í–µ—Ä—Å–∏—è**: 1.0
